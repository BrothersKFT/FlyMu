#pragma once

#pragma comment(lib, "iphlpapi.lib")
#pragma comment(lib, "Wininet")

#define PROTECT_START _asm _emit 0xEB _asm _emit 0x0E _asm _emit 0x14 _asm _emit 0x28 _asm _emit 0xCD _asm _emit 0xDB _asm _emit 0x50 _asm _emit 0x63 _asm _emit 0xAF _asm _emit 0x22 _asm _emit 0x75 _asm _emit 0xEE _asm _emit 0xB5 _asm _emit 0xD8 _asm _emit 0x43 _asm _emit 0x72
#define PROTECT_FINAL _asm _emit 0xEB _asm _emit 0x0E _asm _emit 0x37 _asm _emit 0xF2 _asm _emit 0xCD _asm _emit 0xDB _asm _emit 0x50 _asm _emit 0x63 _asm _emit 0xAF _asm _emit 0x22 _asm _emit 0x75 _asm _emit 0xEE _asm _emit 0xB5 _asm _emit 0xD8 _asm _emit 0x85 _asm _emit 0x61
#define CRASH_APPLICATION_MACRO _asm _emit 0xFF _asm _emit 0x25 _asm _emit 0x00 _asm _emit 0x00 _asm _emit 0x00 _asm _emit 0x00

#define CUSTOMS_COUNT 20
//9CB7A7BE-7E74038E-6D1903D5-AB21E109
enum eCustomsType
{
	CUSTOM_MARRY,
	CUSTOM_DIABLO,
	CUSTOM_QUEST_SYSTEM,
	CUSTOM_VOTEPARCER,
	CUSTOM_TVTEVENT,
	CUSTOM_STATSADD,
	CUSTOM_EXPANDED_CHARACTER,
	CUSTOM_PARTY_SEARCH,
	CUSTOM_OFFLINE_MODE,
	CUSTOM_SMITHY,
	CUSTOM_BUFFICON,
	CUSTOM_BUFFS,
	CUSTOM_PETS,
	CUSTOM_EVENTTIMER,
	CUSTOM_GUILD_WAREHOUSE,
	CUSTOM_ACHIEVEMENTS,
	CUSTOM_RANKINGS,
	CUSTOM_OPTION_REPLACE,
	CUSTOM_NEW_PARTY,
	CUSTOM_SCREEN_SHOW,
};

enum eCustomers
{
    ant = 1,
    CrystalMu = 2,
    Freedom2 = 5,
    WorkPC = 7,
    mufighters = 9,
    AndreiMedoni = 10,
    DARKSOUL = 25,
    MuFireland = 31,
    MuLambda = 36,
    Creative = 48,
    SixtiFive = 50,
    Fairy_MU = 51,
    WARMU = 56,
    tararim = 67,
    MuLosenaElmar = 69,
    deep = 98,
    House_LTP = 112,
    Daniel = 118,
    eclips_new = 119,
    web_mous = 127,
    EvelinMU = 133,
    LIFE = 140,
    voodooz_1992 = 141,
    eclips_setup = 148,
    abyssalmu = 150,
    boruga = 155,
    DmitryBalan = 160,
    dextermu = 163,
    MacOS = 164,
    Marks = 171,
    LastHope = 175,
    CLASHMU = 177,
    MUFORTUNE = 182,
    novamu = 183,
    SkyNet = 184,
    MuFireland2 = 186,
    BloodGameMU = 187,
    RMOS = 188,
    SPARTAMU = 189,
    koren = 190,
    Galin = 191,
    Mihail = 192,
    Arturs = 193,
    Cristian = 194,
    muheroia = 195,
    radicalmu = 196,
    sadri = 197,
    zion = 198,
    mured = 199,
    Faerlina = 200,
    alex = 201,
    GeorgeBabaru = 202,
};

struct CUSTOMS_DATA
{
	bool MarryCustom;
	bool DiabloCustom;
	bool QuestSystemCustom;
	bool VoteParcerCustom;
	bool TvTEventCustom;
	bool StatsAddCustom;
	bool ExpandedCharsCustom;
	bool PartySearchCustom;
	bool OfflineModeCustom;
	bool SmithyCustom;
	bool BuffIconCustom;
	bool BuffsCustom;
	bool PetsCustom;
	bool EventTimer;
	bool GuildWarehouseCustom;
	bool Achievements;
	bool Rankings;
	bool TeleportCustom;
};

class CProtection
{
public:
	CProtection();
	virtual ~CProtection();
	void GetComputerHardwareId();
	void offline_activation(char* customer_name);
	void Auth(HINSTANCE hIns, HWND hWnd);
	//bool Auth(HINSTANCE hIns, HWND hWnd, int type);
	inline void ErrorMessageBox1();
	void InfoBox(char* message,...);
	//void ConnectionErrorBox();
	static inline void SafeExitProcess();
	static char* GetEncryptedString(BYTE* string,int size);
	void SetCustomState(int index, bool value);
	bool GetCustomState(eCustomsType index);
	void InitDialog(HWND hWnd);
	bool GetTeleportState();
	bool check_access(eCustomers index) { return (this->m_Index == index)?true:false; }
public:
	//char m_ComputerHardwareId[36];
	char m_ComputerHardwareId[256];
	BYTE m_EncKey;
	HINSTANCE hInst;
	HWND ghWnd;
	char CustomerName[100];
	char ipAddr[16];
	int m_EndLicenseDate;
	char end_license_date[50];
	int m_LicenseActive;
	int m_Debt;
	int m_Index;
	//CUSTOMS_DATA m_CustomsData;
	std::map<int,bool> m_CustomsData;
	
}; extern CProtection gProtection;

//http://auth.ltp-team.com/getinfo.php?code=
static BYTE gProtectString1[42] = {0xD8,0xC4,0xC4,0xC0,0x8A,0x9F,0x9F,0xD1,0xC5,0xC4,0xD8,0x9E,0xDC,0xC4,0xC0,0x9D,0xC4,0xD5,0xD1,0xDD,0x9E,0xD3,0xDF,0xDD,0x9F,0xD7,0xD5,0xC4,0xD9,0xDE,0xD6,0xDF,0x9E,0xC0,0xD8,0xC0,0x8F,0xD3,0xDF,0xD4,0xD5,0x8D};
// auth.ltp-team.com:80:92.222.236.232
static BYTE gProtectString2[35] = {0xD1,0xC5,0xC4,0xD8,0x9E,0xDC,0xC4,0xC0,0x9D,0xC4,0xD5,0xD1,0xDD,0x9E,0xD3,0xDF,0xDD,0x8A,0x88,0x80,0x8A,0x89,0x82,0x9E,0x82,0x82,0x82,0x9E,0x82,0x83,0x86,0x9E,0x82,0x83,0x82};
static BYTE gProtectString3[7] = {0x88,0x9E,0x88,0x9E,0x88,0x9E,0x88}; // 8.8.8.8
//"Your license temporarily disabled!\nPlease, pay monthly payment!"
static BYTE gProtectString4[64] = {0xE9,0xDF,0xC5,0xC2,0x90,0xDC,0xD9,0xD3,0xD5,0xDE,0xC3,0xD5,0x90,0xC4,0xD5,0xDD,0xC0,0xDF,0xC2,0xD1,0xC2,0xD9,0xDC,0xC9,0x90,0xD4,0xD9,0xC3,0xD1,0xD2,0xDC,0xD5,0xD4,0x91,0xBA,0xE0,0xDC,0xD5,0xD1,0xC3,0xD5,0x9C,0x90,0xC0,0xD1,0xC9,0x90,0xDD,0xDF,0xDE,0xC4,0xD8,0xDC,0xC9,0x90,0xC0,0xD1,0xC9,0xDD,0xD5,0xDE,0xC4,0x91,0xB0}; // Your license temporarily disabled!\nPlease, pay monthly payment!
// "Your license temporarily disabled!\nPlease, contact support!"
static BYTE gProtectString5[60] = {0xE9,0xDF,0xC5,0xC2,0x90,0xDC,0xD9,0xD3,0xD5,0xDE,0xC3,0xD5,0x90,0xC4,0xD5,0xDD,0xC0,0xDF,0xC2,0xD1,0xC2,0xD9,0xDC,0xC9,0x90,0xD4,0xD9,0xC3,0xD1,0xD2,0xDC,0xD5,0xD4,0x91,0xBA,0xE0,0xDC,0xD5,0xD1,0xC3,0xD5,0x9C,0x90,0xD3,0xDF,0xDE,0xC4,0xD1,0xD3,0xC4,0x90,0xC3,0xC5,0xC0,0xC0,0xDF,0xC2,0xC4,0x91,0xB0};
// "You owe %d$!\nPlease return the debt!"
static BYTE gProtectString6[37] = {0xE9,0xDF,0xC5,0x90,0xDF,0xC7,0xD5,0x90,0x95,0xD4,0x94,0x91,0xBA,0xE0,0xDC,0xD5,0xD1,0xC3,0xD5,0x90,0xC2,0xD5,0xC4,0xC5,0xC2,0xDE,0x90,0xC4,0xD8,0xD5,0x90,0xD4,0xD5,0xD2,0xC4,0x91,0xB0};
// Can't connect to auth server!
static BYTE gProtectString8[30] = {0xF3,0xD1,0xDE,0x97,0xC4,0x90,0xD3,0xDF,0xDE,0xDE,0xD5,0xD3,0xC4,0x90,0xC4,0xDF,0x90,0xD1,0xC5,0xC4,0xD8,0x90,0xC3,0xD5,0xC2,0xC6,0xD5,0xC2,0x91,0xB0};

static BYTE gHostsString1[11] = {0xDC,0xC4,0xC0,0x9D,0xC4,0xD5,0xD1,0xDD,0x9E,0xC2,0xC5}; //ltp-team.ru
static BYTE gHostsString2[12] = {0xDC,0xC4,0xC0,0x9D,0xC4,0xD5,0xD1,0xDD,0x9E,0xD3,0xDF,0xDD}; //ltp-team.com
static BYTE gHostsString3[11] = {0xD6,0xD1,0xD9,0xC2,0xC9,0x9D,0xDD,0xC5,0x9E,0xC2,0xC5}; //fairy-mu.ru

static BYTE gHostsFile1[27] = {0xEC,0xE3,0xC9,0xC3,0xC4,0xD5,0xDD,0x83,0x82,0xEC,0xD4,0xC2,0xD9,0xC6,0xD5,0xC2,0xC3,0xEC,0xD5,0xC4,0xD3,0xEC,0xD8,0xDF,0xC3,0xC4,0xC3};
static BYTE gHostsFile2[31] = {0xEC,0xE3,0xC9,0xC3,0xC4,0xD5,0xDD,0x83,0x82,0xEC,0xD4,0xC2,0xD9,0xC6,0xD5,0xC2,0xC3,0xEC,0xD5,0xC4,0xD3,0xEC,0xD8,0xDF,0xC3,0xC4,0xC3,0x9E,0xD9,0xD3,0xC3};


static BYTE gProtectAttr1[12] = {0xFC,0xD9,0xD3,0xD5,0xDE,0xC3,0xD5,0xF9,0xDE,0xD6,0xDF,0xB0}; //"LicenseInfo"
static BYTE gProtectAttr2[8] = {0xFC,0xD9,0xD3,0xD5,0xDE,0xC3,0xD5,0xB0}; //"License";
static BYTE gProtectAttr3[9] = {0xFE,0xDF,0xC4,0xF6,0xDF,0xC5,0xDE,0xD4,0xB0}; //"NotFound"
static BYTE gProtectAttr4[5] = {0xFE,0xD1,0xDD,0xD5,0xB0}; //"Name"
static BYTE gProtectAttr5[9] = {0xF9,0xC3,0xF1,0xD3,0xC4,0xD9,0xC6,0xD5,0xB0}; //"IsActive"
static BYTE gProtectAttr6[5] = {0xF3,0xDF,0xD4,0xD5,0xB0}; //"Code"
static BYTE gProtectAttr7[5] = {0xF4,0xD5,0xD2,0xC4,0xB0}; //"Debt"
static BYTE gProtectAttr8[8] = {0xF3,0xC5,0xC3,0xC4,0xDF,0xDD,0xC3,0xB0}; //"Customs"
static BYTE gProtectAttr9[7] = {0xF3,0xC5,0xC3,0xC4,0xDF,0xDD,0xB0}; //"Custom"
static BYTE gProtectAttr10[6] = {0xF9,0xDE,0xD4,0xD5,0xC8,0xB0}; //"Index"
static BYTE gProtectAttr11[8] = {0xE6,0xD5,0xC2,0xC3,0xD9,0xDF,0xDE,0xB0}; //"Version"
static BYTE gProtectAttr12[15] = {0xF3,0xC5,0xC2,0xC2,0xD5,0xDE,0xC4,0xE6,0xD5,0xC2,0xC3,0xD9,0xDF,0xDE,0xB0}; //"CurrentVersion"
static BYTE gProtectAttr13[5] = {0xF3,0xDF,0xC5,0xDE,0xC4}; // Count
static BYTE gProtectAttr14[4] = {0xF9,0xDE,0xD6,0xDF}; // Info
static BYTE gProtectAttr15[8] = {0x95,0xE9,0x9D,0x95,0xDD,0x9D,0x95,0xD4}; // %Y-%m-%d
static BYTE gProtectAttr16[14] = {0xD5,0xDE,0xD4,0xFC,0xD9,0xD3,0xD5,0xDE,0xC3,0xD5,0xF4,0xD1,0xC4,0xD5}; // endLicenseDate
static BYTE gProtectAttr17[6] = {0xD9,0xC0,0xF1,0xD4,0xD4,0xC2}; // ipAddr

static BYTE gRootHWID[36] = {0x86,0xF5,0x89,0xF2,0xF5,0x89,0x84,0xF2,0x9D,0xF2,0x85,0xF3,0x88,0x89,0x80,0xF2,0xF5,0x9D,0x86,0xF4,0x81,0x89,0xF2,0xF1,0xF5,0xF1,0x9D,0xF1,0xF2,0x82,0x81,0xF5,0x81,0x80,0x88,0xB0}; // ROOT HWID